"""
–ü—É—Ç—å: src/bot/handlers/my_pairs/my_pairs_formatters.py
–û–ø–∏—Å–∞–Ω–∏–µ: –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ —Ç–æ—Ä–≥–æ–≤—ã—Ö –ø–∞—Ä
–ê–≤—Ç–æ—Ä: Crypto Bot Team
–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è: 2025-07-28
"""

from config.bot_config import get_bot_config
from utils.time_helpers import get_timeframe_display_name


def create_no_pairs_message() -> str:
    """
    –°–æ–∑–¥–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –ø–∞—Ä.

    Returns:
        str: –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –ø–∞—Ä
    """
    return """üìà <b>–ú–æ–∏ —Ç–æ—Ä–≥–æ–≤—ã–µ –ø–∞—Ä—ã</b>

–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç —Ç–æ—Ä–≥–æ–≤—ã—Ö –ø–∞—Ä –≤ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–∏.

<b>–ß—Ç–æ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:</b>
‚Ä¢ –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –ø–∞—Ä—É —á–µ—Ä–µ–∑ "‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä—É"
‚Ä¢ –ò–∑—É—á–∏—Ç—å —Å–ø—Ä–∞–≤–∫—É –æ —Ä–∞–±–æ—Ç–µ –±–æ—Ç–∞

<i>–ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–∞—Ä –∑–¥–µ—Å—å –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è —Å–ø–∏—Å–æ–∫ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–∞–π–º—Ñ—Ä–µ–π–º–∞–º–∏ –∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤.</i>"""


def create_pairs_list_message(user_pairs: list) -> str:
    """
    –°–æ–∑–¥–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–æ —Å–ø–∏—Å–∫–æ–º –ø–∞—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

    Args:
        user_pairs: –°–ø–∏—Å–æ–∫ –ø–∞—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

    Returns:
        str: –°–æ–æ–±—â–µ–Ω–∏–µ —Å–æ —Å–ø–∏—Å–∫–æ–º –ø–∞—Ä
    """
    pairs_count = len(user_pairs)

    text = f"üìà <b>–ú–æ–∏ —Ç–æ—Ä–≥–æ–≤—ã–µ –ø–∞—Ä—ã ({pairs_count})</b>\n\n"

    for i, user_pair in enumerate(user_pairs, 1):
        pair = user_pair.pair
        enabled_timeframes = user_pair.get_enabled_timeframes()

        text += f"<b>{i}. {pair.display_name}</b>\n"
        text += f"   ‚Ä¢ –°–∏–º–≤–æ–ª: {pair.symbol}\n"
        text += f"   ‚Ä¢ –¢–∞–π–º—Ñ—Ä–µ–π–º—ã: {len(enabled_timeframes)}/{len(user_pair.timeframes)} –∞–∫—Ç–∏–≤–Ω—ã—Ö\n"
        text += f"   ‚Ä¢ –°–∏–≥–Ω–∞–ª–æ–≤ –ø–æ–ª—É—á–µ–Ω–æ: {user_pair.signals_received}\n\n"

    text += "<i>–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –ø–∞—Ä—É –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–∞–π–º—Ñ—Ä–µ–π–º–∞–º–∏ –∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤.</i>"

    return text


def create_pair_management_message(user_pair) -> str:
    """
    –°–æ–∑–¥–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–∞—Ä–æ–π.

    Args:
        user_pair: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –ø–∞—Ä–∞

    Returns:
        str: –°–æ–æ–±—â–µ–Ω–∏–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–∞—Ä–æ–π
    """
    pair = user_pair.pair
    enabled_timeframes = user_pair.get_enabled_timeframes()
    config = get_bot_config()

    text = f"""‚öôÔ∏è <b>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–æ–π {pair.display_name}</b>

<b>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–∞—Ä–µ:</b>
‚Ä¢ –°–∏–º–≤–æ–ª: {pair.symbol}
‚Ä¢ –ë–∞–∑–æ–≤–∞—è –≤–∞–ª—é—Ç–∞: {pair.base_asset}
‚Ä¢ –ö–æ—Ç–∏—Ä—É–µ–º–∞—è –≤–∞–ª—é—Ç–∞: {pair.quote_asset}
‚Ä¢ –ü–æ–ª—É—á–µ–Ω–æ —Å–∏–≥–Ω–∞–ª–æ–≤: {user_pair.signals_received}

<b>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–∞–π–º—Ñ—Ä–µ–π–º–æ–≤:</b>
–í–∫–ª—é—á–∏—Ç–µ –Ω—É–∂–Ω—ã–µ —Ç–∞–π–º—Ñ—Ä–µ–π–º—ã –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–∏–≥–Ω–∞–ª–æ–≤"""

    # –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ —Ç–∞–π–º—Ñ—Ä–µ–π–º–æ–≤
    if enabled_timeframes:
        text += f"\n\n<b>–ê–∫—Ç–∏–≤–Ω—ã–µ —Ç–∞–π–º—Ñ—Ä–µ–π–º—ã ({len(enabled_timeframes)}):</b>\n"
        text += ", ".join(enabled_timeframes)
    else:
        text += f"\n\n‚ö†Ô∏è <b>–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ç–∞–π–º—Ñ—Ä–µ–π–º–æ–≤</b>\n–í—ã –Ω–µ –±—É–¥–µ—Ç–µ –ø–æ–ª—É—á–∞—Ç—å —Å–∏–≥–Ω–∞–ª—ã –ø–æ —ç—Ç–æ–π –ø–∞—Ä–µ."

    text += f"\n\n<i>üí° –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –Ω–∏–∂–µ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–∞–π–º—Ñ—Ä–µ–π–º–∞–º–∏ –∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ RSI.</i>"

    return text


def create_rsi_display_message(user_pair, rsi_data: dict) -> str:
    """
    –°–æ–∑–¥–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º RSI.

    Args:
        user_pair: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –ø–∞—Ä–∞
        rsi_data: –î–∞–Ω–Ω—ã–µ RSI –ø–æ —Ç–∞–π–º—Ñ—Ä–µ–π–º–∞–º

    Returns:
        str: –°–æ–æ–±—â–µ–Ω–∏–µ —Å RSI –¥–∞–Ω–Ω—ã–º–∏
    """
    pair = user_pair.pair

    text = f"""üìä <b>RSI –¥–ª—è {pair.display_name}</b>

<b>–¢–µ–∫—É—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ RSI:</b>"""

    if not rsi_data:
        text += "\n\n‚ùå <b>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</b>\n–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∞–∫—Ç–∏–≤–Ω—ã–µ —Ç–∞–π–º—Ñ—Ä–µ–π–º—ã."
        return text

    # –î–æ–±–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ –∫–∞–∂–¥–æ–º—É —Ç–∞–π–º—Ñ—Ä–µ–π–º—É
    for timeframe, data in rsi_data.items():
        display_name = get_timeframe_display_name(timeframe)

        if "error" in data:
            error_text = str(data['error']).replace('<', '&lt;').replace('>', '&gt;')
            text += f"\n\n<b>{display_name}:</b> ‚ùå {error_text}"
        else:
            rsi_value = data.get("value", 0)
            interpretation = data.get("interpretation", {})

            # –≠–º–æ–¥–∑–∏ –¥–ª—è —É—Ä–æ–≤–Ω—è RSI
            if rsi_value <= 30:
                emoji = "üî¥"  # –ü–µ—Ä–µ–ø—Ä–æ–¥–∞–Ω–Ω–æ—Å—Ç—å
                level = "–ø–µ—Ä–µ–ø—Ä–æ–¥–∞–Ω–Ω–æ—Å—Ç—å"
            elif rsi_value >= 70:
                emoji = "üü¢"  # –ü–µ—Ä–µ–∫—É–ø–ª–µ–Ω–Ω–æ—Å—Ç—å
                level = "–ø–µ—Ä–µ–∫—É–ø–ª–µ–Ω–Ω–æ—Å—Ç—å"
            else:
                emoji = "üü°"  # –ù–µ–π—Ç—Ä–∞–ª—å–Ω–∞—è –∑–æ–Ω–∞
                level = "–Ω–µ–π—Ç—Ä–∞–ª—å–Ω–∞—è –∑–æ–Ω–∞"

            text += f"\n\n<b>{display_name}:</b> {emoji} <b>{rsi_value:.1f}</b>"
            text += f"\n   ‚îî {level}"

    text += f"\n\n<i>‚è∞ –î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏</i>"
    text += f"\n<i>üí° RSI &lt; 30 = –ø–µ—Ä–µ–ø—Ä–æ–¥–∞–Ω–Ω–æ—Å—Ç—å, RSI &gt; 70 = –ø–µ—Ä–µ–∫—É–ø–ª–µ–Ω–Ω–æ—Å—Ç—å</i>"
    # –î–æ–±–∞–≤–ª—è–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
    from datetime import datetime
    timestamp = datetime.now().strftime("%H:%M:%S")
    text += f"\n\n<i>üïê –ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: {timestamp}</i>"

    return text

def create_rsi_error_message() -> str:
    """
    –°–æ–∑–¥–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ RSI.

    Returns:
        str: –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
    """
    return """‚ùå <b>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ RSI –¥–∞–Ω–Ω—ã—Ö</b>

–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä RSI –¥–ª—è —ç—Ç–æ–π –ø–∞—Ä—ã.

<b>–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:</b>
‚Ä¢ –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
‚Ä¢ –í—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Å —Ä–∞—Å—á–µ—Ç–æ–º
‚Ä¢ –ü—Ä–æ–±–ª–µ–º—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

<b>–ß—Ç–æ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:</b>
‚Ä¢ –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç
‚Ä¢ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –ø–∞—Ä–∞ –Ω–µ–¥–∞–≤–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∞
‚Ä¢ –û–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É

<i>–û–±—ã—á–Ω–æ –¥–∞–Ω–Ω—ã–µ —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –¥–æ—Å—Ç—É–ø–Ω—ã —á–µ—Ä–µ–∑ 1-2 –º–∏–Ω—É—Ç—ã –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–∞—Ä—ã.</i>"""